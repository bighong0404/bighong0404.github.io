# 现象

缓存雪崩就是在某一个时刻，大量流量直接打到数据库上，对数据库造成巨大压力, 进而拖垮整个系统。



# 原因

1. 缓存数据大面积失效
2. redis集群挂了



# 方案

1. 如果是缓存数据大面积失效，则可以在设置过期时间的时，加随机值来错开缓存过期时间. 避免同一个时间点的数据大面积过期. 
2. 如果是redis集群挂了.需要分阶段处理. 

- 事前预案
  - 数据备份, RDB, AOF, 定期RDB数据在云存储备份一份
  - 选用哨兵模式/集群模式, 多挂几个**slave冗余**
  - 双机房部署，一套redis cluster，部分机器在一个机房，另一部分机器在另外一个机房
- 事中处理(此时redis集群已经挂了)
  - 多级缓存, 服务增加本地缓存(`ehcache`等), 在redis集群失效时候还能抗一会
  - 对源服务访问的限流以及资源隔离(`hystrix`)
  - 降级
- 事后恢复
  - 数据备份文件存在(`在服务器上没丢失或者从云存储拉下来`), 重启redis自动恢复. 
  - 备份没了或者数据过旧,  重启redis后进行快速缓存预热. 











