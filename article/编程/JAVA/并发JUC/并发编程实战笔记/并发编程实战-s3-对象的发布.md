
> #### 发布与逸出
> 发布指一个对象能够在当前作用域之外的代码中使用, 例如静态变量, 能被其他类直接引用使用.
> 逸出指不应该发布的对象被发布了. 例如private变量被public方法返回了, 变量逸出了它所在的作用域.

> #### 线程封闭
> 线程封闭是不共享数据, 仅在单线程内访问数据的方式. 这是实现线程安全最简单的方式之一. 
> * Ad-hoc线程封闭: 维护线程封闭性的职责完全由程序实现来承担
```(Ad hoc是拉丁文常用短语中的一个短语。这个短语的意思是'特设的、特定目的的（地）、即席的、临时的、将就的、专案的'。这个短语通常用来形容一些特殊的、不能用于其它方面的的，为一个特定的问题、任务而专门设定的解决方案。)```
> * 栈封闭: 使用局部变量. 基本类型的局部变量由于java语法, 是不会被逸出, 但引用型局部变量(类), 若被发布了, 会被其他外部代码引用到, 则线程封闭性就被打破了.
> * ThreadLocal类: 规范的线程封闭方式.

> #### 不可变对象```(注意不可变的对象和不可变的对象引用的区别)```
> 对象在被***创建后***其状态不能被修改, 那么就是***不可变对象***. 不可变对象一定是线程安全的.
> 满足同步需求的另一种方式是使用不可变对象
> #####满足一下条件的对象, 才是不可变的:
> * 对象***创建***后其状态不能修改.
>* 对象的所有域都是final
>* 对象是正确创建的(创建期间, this引用没有逸出)

> #### 安全发布(线程安全)的常用模式
> 安全发布一个对象, ***对象的引用***和***对象的状态***必须***同时***对其他线程***可见***, 有以下几种方式:
> * 在***静态初始化函数***中***初始***化一个对象引用. 
> 最简单安全的静态初始化器: ```public static Holder holder = new Holder();```
> 静态初始化器由JVM在类的初始化阶段执行, JVM内部存在着同步机制, 因此这种方式非常安全方便.
> * 将对象的引用保存到***volatile***类型的域或者***AtomicReference***对象中
> * 将对象的引用保存到某个***正确构造***对象的***final***类型域中
> * 将对象的引用保存到一个由***锁***保护的域中
> ##### Java线程安全库提供了以下容器类保证对象的安全发布:
> * Hashtable, synchronizedMap, ConcurrentMap
> * Vector, CopyOnWriteArrayList, CopyOnWriteArraySet, SynchronizedList, SynchronizedSet
> * BlockingQueue, ConcurrentLinkedQueue

> #### 事实不可变对象
> 对象从技术来看是可变的, 但其状态在***发布后***不会再改变, 那么就称为"事实不可变对象". 
> 事实不可变对象, 在发布之后, 程序可以当做不可变对象处理. 

> #### 可变对象
> 要共享可变对象, 就要安全地发布这些对象, 并且必须是线程安全或者由锁保护```(安全发布方式看上面)```

> #### 对象的发布方式取决于它的可变性
> * 不可变对象可以随意方式发布.
> * 事实不可变对象必须通过安全的方式来发布.
> * 可变对象必须通过安全的方式来发布, 并且必须是线程安全的或者由锁保护.

> #### 安全地共享对象  
> 并发程序中使用和共享对象时, 可以使用一些实用策略:
> * **线程封闭。** 线程封闭的对象只能由一个线程拥有, 对象被封闭在该线程中, 并且只能这个线程修改.
> * **只读共享。** 共享的只读对象包括不可变对象跟事实不可变对象.  只读对象任何线程都不能修改.
> * **线程安全共享。**线程安全的对象在其内部实现同步, 因此对个线程可以通过对象的共有接口来访问而不需要进一步的同步.
> * **保护对象。** 被保护的对象只能通过持有特定的***锁***来访问。保护对象包括封装在其他线程安全对象中的对象， 以及已发布的并且由某个特定锁保护的对象。
