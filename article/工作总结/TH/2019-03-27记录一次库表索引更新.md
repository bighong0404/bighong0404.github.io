本次发版需要更新一张业务表, 而这张表已经运行了2年, 对应功能入口在app中不是显眼的位置, 因此数据量也不会特别大, 600多w记录.  但对一张mysql的表来说600w数据也不少了. 

这张表除了主键外, 原先只有一个唯一索引, 业务功能的查询全都是走这个索引. 更新了功能后, 需要删除这个唯一索引, 修改为普通索引.  在执行操作时候, 先提交删除索引语句, DBA在阿里云mysql监控页面观察到立刻出现了非常多这块功能的查询语句. 因为所以删除了, 数据查询变成全表扫描, 非常慢, CPU占用飙升到100%. 立刻请运维小伙伴把服务停掉, 把新索引建好后再restart服务. 

总结: 有涉及的索引的修改, 建议先把替代的新索引建好, 再把老索引删除. 不然可能导致查询没走索引而全表扫.
